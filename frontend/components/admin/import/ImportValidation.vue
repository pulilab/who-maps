<template>
  <div>
    <div v-if="errors" class="GlobalErrors">
      <el-tag v-for="error in errors" :key="error" type="danger">
        <fa icon="exclamation" />
        <translate :parameters="{ column: error }">
          Please select the "{column}" column
        </translate>
      </el-tag>
    </div>
    <slot
      :rules="validationRules"
      :globalErrors="errors"
      :nameMapping="nameMapping"
    />
  </div>
</template>

<script>
import { draftRules, publishRules } from '@/utilities/projects'
import { nameMapping } from '@/utilities/import'

export default {
  props: {
    headers: {
      type: Array,
      default: () => []
    },
    publish: {
      type: Boolean,
      default: false
    }
  },
  computed: {
    internalDraftRules () {
      return { ...draftRules() }
    },
    internalPublishRules () {
      const standardRules = publishRules()
      return {
        ...standardRules,
        strategies: undefined,
        digitalHealthInterventions: standardRules.strategies,
        ...standardRules.national_level_deployment
      }
    },
    validationRules () {
      const rules = this.publish ? this.internalPublishRules : this.internalDraftRules
      return {
        ...rules,
        team: undefined,
        viewers: undefined
        // country: undefined,
        // donors: undefined
      }
    },
    nameMapping () {
      return {
        ...nameMapping
      }
    },
    errors () {
      const result = []
      const draftRequireds = []
      for (const key in this.validationRules) {
        if (this.validationRules[key] && this.validationRules[key].required) {
          draftRequireds.push(key)
        }
      }
      draftRequireds.forEach(dr => {
        if (!this.headers.some(h => h.selected === dr)) {
          const name = this.nameMapping[dr] || dr
          result.push(name)
        }
      })
      return result
    }
  }

}
</script>

<style lang="less" scoped>
  .GlobalErrors {
    .el-tag {
      margin: 0 10px 10px 0px;

      .svg-inline--fa {
        margin-right: 3px;
      }
    }
  }
</style>
