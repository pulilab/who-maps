
<div id="clv-container" layout="column">

    <md-card md-whiteframe="2" class="rel" layout="row">
        <div class="littleheader">COUNTRY LEVEL VIEW</div>
        <md-tabs md-border-bottom md-dynamic-height md-center-tabs="true" flex="75" class="clv-tab-container">

            <!-- MAP VIEW -->
            <md-tab label="map view">

                <div class="tab-wrap" id="map" ng-class="{'emptyy': !vm.projectsData}">

                    <md-card md-whiteframe="2" class="countrychoser">
                        <md-input-container>
                            <md-select
                              class="no-border"
                              md-container-class="country-chooser topalign"
                              ng-model-options="{trackBy: '$value.id'}"
                              placeholder='Select a country'
                              ng-model="vm.selectedCountry"
                              ng-change="vm.updateCountry(vm.selectedCountry)">
                                <md-option ng-repeat="country in vm.countries track by $index" ng-value="country">{{country.name}}</md-option>

                            </md-select>
                        </md-input-container>
                    </md-card>

                    <countrymap big="true"></countrymap>

                </div>

            </md-tab>


            <!-- LIST VIEW -->
            <md-tab label="list view">
                <div class="tab-wrap" id="list">

                    <div class="headercont" layout="row">
                        <div class="exports" flex="grow">
                            <md-button class="md-primary" ng-show="vm.projectsData && vm.projectsData.length > 0" ng-click="vm.exportCSV()">
                                <md-icon>file_download</md-icon>
                                Export (CSV)
                            </md-button>
                            <md-button class="md-primary" ng-show="vm.projectsData && vm.projectsData.length > 0" ng-click="vm.exportPDF()">
                                <md-icon>file_download</md-icon>
                                Export (PDF)
                            </md-button>
                        </div>

                        <div class="starry" flex="no-grow">
                            <span><md-icon>visibility</md-icon>
                            Viewer</span>
                            <span><md-icon>grade</md-icon>
                              Team member</span>
                        </div>

                        <md-card md-whiteframe="2" class="countrychoser" flex="nogrow">
                            <md-input-container>
                                <md-select
                                  class="no-border"
                                  md-container-class="country-chooser topalign"
                                  ng-model-options="{trackBy: '$value.id'}"
                                  placeholder='Select a country'
                                  ng-model="vm.selectedCountry"
                                  ng-change="vm.updateCountry(vm.selectedCountry)">
                                    <md-option ng-value="vm.showAllCountries">Show all countries</md-option>
                                    <md-option ng-repeat="country in vm.countries track by $index" ng-value="{{country}}">{{country.name}}</md-option>

                                </md-select>
                            </md-input-container>
                        </md-card>
                    </div>

                    <md-content class="projectcont">

                        <div class="headerrow" layout="row" layout-padding md-whiteframe="2">
                            <div flex="35" ng-click="vm.orderTable('name')">
                                Project name
                                <md-icon ng-show="vm.header.name.up" >expand_more</md-icon>
                                <md-icon ng-show="vm.header.name.down" >expand_less</md-icon>
                            </div>
                            <div flex="15" ng-click="vm.orderTable('country')">
                                Country
                                <md-icon ng-show="vm.header.country.up" >expand_more</md-icon>
                                <md-icon ng-show="vm.header.country.down" >expand_less</md-icon>
                            </div>
                            <div flex="25" ng-click="vm.orderTable('organisation_name')">
                                Organisation name
                                <md-icon ng-show="vm.header.organisation_name.up" >expand_more</md-icon>
                                <md-icon ng-show="vm.header.organisation_name.down" >expand_less</md-icon>
                            </div>
                            <div flex="20" ng-click="vm.orderTable('donors')">
                                Donors
                                <md-icon ng-show="vm.header.donors.up" >expand_more</md-icon>
                                <md-icon ng-show="vm.header.donors.down" >expand_less</md-icon>
                            </div>
                            <div flex="20" ng-click="vm.orderTable('contact_name')">
                                Contact Name
                                <md-icon ng-show="vm.header.contact_name.up" >expand_more</md-icon>
                                <md-icon ng-show="vm.header.contact_name.down" >expand_less</md-icon>
                            </div>
                            <div flex="30" ng-click="vm.orderTable('implementation_overview')">
                                Overview of digital health implementation
                                <md-icon ng-show="vm.header.implementation_overview.up" >expand_more</md-icon>
                                <md-icon ng-show="vm.header.implementation_overview.down" >expand_less</md-icon>
                            </div>
                            <div flex="20" ng-click="vm.orderTable('implementing_partners')">
                                Implementing partners
                                <md-icon ng-show="vm.header.implementing_partners.up" >expand_more</md-icon>
                                <md-icon ng-show="vm.header.implementing_partners.down" >expand_less</md-icon>
                            </div>
                            <div flex="20" ng-click="vm.orderTable('geographic_scope')">
                                Geographic scope
                                <md-icon ng-show="vm.header.geographic_scope.up" >expand_more</md-icon>
                                <md-icon ng-show="vm.header.geographic_scope.down" >expand_less</md-icon>
                            </div>
                            <div flex="20" ng-click="vm.orderTable('health_focus_areas')">
                                Health Focus Areas
                                <md-icon ng-show="vm.header.health_focus_areas.up" >expand_more</md-icon>
                                <md-icon ng-show="vm.header.health_focus_areas.down" >expand_less</md-icon>
                            </div>
                        </div>

                        <div
                          class="projectrow"
                          layout="row"
                          layout-padding
                          ng-repeat="project in vm.projectsData track by $index"
                          ng-class="{'member': vm.isMember(project), 'viewer': vm.isViewer(project)}">

                            <div flex="35" class="projectlink" layout="row">
                                <div flex class="name">
                                    <md-icon class="member" ng-show="vm.isMember(project)">grade</md-icon>
                                    <md-icon class="viewer" ng-show="vm.isViewer(project)">visibility</md-icon>
                                    {{project.name}}
                                </div>
                                <div layout="column" class="links">
                                    <span ng-hide="vm.isMember(project) || vm.isViewer(project)" ui-sref="public-dashboard({ appName: project.id })">Project Dashboard</span>
                                    <span ng-show="vm.isMember(project) || vm.isViewer(project)" ui-sref="dashboard({ appName: project.id })">Project Dashboard</span>
                                </div>
                            </div>
                            <div flex="20" class="cap">
                                {{vm.countriesLib[project.country]}}
                            </div>
                            <div flex="20">{{project.organisation_name}}</div>
                            <div flex="20">
								                <span ng-repeat="donor in project.donors">
                                    {{donor}}{{$last ? '' : ', '}}
								                </span>
                            </div>
                            <div flex="20">{{project.contact_name}}, <a ng-href="mailto:{{project.contact_email}}">{{project.contact_email}}</a></div>
                            <div flex="30">{{project.implementation_overview}}</div>
                            <div flex="20">{{vm.printImplementingPartners(project)}}</div>
                            <div flex="20">{{project.geographic_scope}}</div>
                            <div flex="20">{{project.health_focus_areas.join(', ')}}</div>

                        </div>
                        <div ng-if="!vm.projectsData.length" class="projectrow" layout="row" layout-padding>
                            <div flex>There is no project to show in this country.</div>
                        </div>
                    </md-content>
                </div>
            </md-tab>
        </md-tabs>

        <div class="clv-filter-container" flex="25" layout="row">
            <div class="filter-wrapper" layout="row" flex="100">
                <div class="filter-project-counter" md-whiteframe="2">
                    <div class="project-counter-name">
                        <div class="description">
                            Number of Projects
                        </div>
                        <div class="country-name">
                            in {{vm.selectedCountry.name}}
                        </div>
                    </div>
                    <div class="project-counter-arrow">
                        <img src="img/after-white.svg" />
                    </div>
                    <div class="project-counter-number">
                        {{ vm.projectsData.length}}
                    </div>
                </div>

                <div class="filter-list">
                    <div class="description">
                        Apply filters to map:
                    </div>

                    <div class="list-headers" ng-repeat="header in vm.filters">
                        <div class="header" ng-click="header.open = !header.open">
                            <md-icon ng-hide="header.open" >expand_more</md-icon>
                            <md-icon ng-show="header.open" >expand_less</md-icon>
                            {{header.name}} ({{header.items.length}})
                        </div>
                        <div class="list-item" ng-repeat="item in header.items  | orderBy: 'name' " ng-show="header.open">
                            <md-checkbox class="md-primary" ng-model="item.value" aria-label="item.name">
                                {{item.name}}
                            </md-checkbox>
                        </div>

                    </div>

                </div>

            </div>

        </div>
    </md-card>

    <disclaimer></disclaimer>
</div>
