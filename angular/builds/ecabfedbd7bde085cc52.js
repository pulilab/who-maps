(window["webpackJsonp"] = window["webpackJsonp"] || []).push([[4],{

/***/ "./src/App/app-run.js":
/*!****************************!*\
  !*** ./src/App/app-run.js ***!
  \****************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\nexports.setAxiosBaseTokenIfInStorage = exports.checkProfile = exports.scrollToTopOnSuccess = exports.run = undefined;\n\nvar _language = __webpack_require__(/*! ../plugins/language */ \"./src/plugins/language.js\");\n\nvar _projects = __webpack_require__(/*! ../store/modules/projects */ \"./src/store/modules/projects.js\");\n\nvar ProjectsModule = _interopRequireWildcard(_projects);\n\nvar _user = __webpack_require__(/*! ../store/modules/user */ \"./src/store/modules/user.js\");\n\nvar UserModule = _interopRequireWildcard(_user);\n\nvar _countries = __webpack_require__(/*! ../store/modules/countries */ \"./src/store/modules/countries.js\");\n\nvar CountryModule = _interopRequireWildcard(_countries);\n\nvar _axios = __webpack_require__(/*! ../plugins/axios */ \"./src/plugins/axios.js\");\n\nvar _axios2 = _interopRequireDefault(_axios);\n\nvar _Storage = __webpack_require__(/*! ../Storage */ \"./src/Storage.js\");\n\nvar _Storage2 = _interopRequireDefault(_Storage);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\nfunction _asyncToGenerator(fn) { return function () { var gen = fn.apply(this, arguments); return new Promise(function (resolve, reject) { function step(key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { return Promise.resolve(value).then(function (value) { step(\"next\", value); }, function (err) { step(\"throw\", err); }); } } return step(\"next\"); }); }; }\n\nvar storage = new _Storage2.default();\n\nfunction scrollToTopOnSuccess(type, from, to) {\n    if (type === 'success' && (from.name !== to.name || to.name === 'editProject')) {\n        var mainContent = document.getElementsByClassName('main-content')[0];\n        if (mainContent) {\n            mainContent.scrollTop = 0;\n        }\n    }\n}\n\nfunction checkProfile(profile, t) {\n    if (!profile || !profile.name || !profile.country || !profile.organisation_id) {\n        console.log('You can not navigate to that area without a user profile');\n        return t.router.stateService.target('editProfile');\n    }\n    return Promise.resolve();\n}\n\nfunction setCountryIfEmpty(to, $ngRedux) {\n    var state = $ngRedux.getState();\n    if (to.name === 'dashboard' && state.countries.currentCountry === null) {\n        $ngRedux.dispatch(CountryModule.setCurrentCountry(state.user.profile.country));\n    }\n}\n\nfunction setAxiosBaseTokenIfInStorage() {\n    var tkn = storage.get('token');\n    if (tkn) {\n        _axios2.default.setAuthToken(tkn);\n    }\n}\n\nvar run = function run($rootScope, $state, $mdToast, $mdDialog, $ngRedux, $timeout, $transitions, gettextCatalog) {\n    (0, _language.setCatalog)(gettextCatalog);\n    (0, _language.setScope)($rootScope);\n    (0, _language.getLanguage)();\n    var transitionStart = new Event('RouterTransitionStart');\n    var transitionDone = new Event('RouterTransitionDone');\n    setAxiosBaseTokenIfInStorage();\n\n    $transitions.onStart({}, function () {\n        window.dispatchEvent(transitionStart);\n        return Promise.resolve();\n    });\n\n    $transitions.onSuccess({}, function (t) {\n        scrollToTopOnSuccess(t.from(), t.to());\n        setCountryIfEmpty(t.to(), $ngRedux);\n        return Promise.resolve();\n    });\n\n    $transitions.onError({}, function () {\n        return Promise.resolve();\n    });\n\n    $transitions.onFinish({}, function (t) {\n        var to = t.to();\n        window.dispatchEvent(transitionDone);\n        $ngRedux.dispatch(ProjectsModule.setCurrentProject(t.params().appName));\n        var state = $ngRedux.getState();\n        if (to && to.profileRequired) {\n            return checkProfile(state.user.profile, t);\n        }\n        if (to && to.forbidAuthenticated && state.user.token) {\n            return t.router.stateService.target('my-projects');\n        }\n        return Promise.resolve();\n    });\n\n    var showPopUp = function showPopUp() {\n        $mdToast.show($mdToast.simple().textContent(gettextCatalog.getString('Ops! something went wrong, try again later.')).position('bottom right').hideDelay(3000));\n    };\n\n    var authPopup = undefined;\n    var showCredentialsPopUp = function () {\n        var _ref = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee() {\n            var mainUi, message;\n            return regeneratorRuntime.wrap(function _callee$(_context) {\n                while (1) {\n                    switch (_context.prev = _context.next) {\n                        case 0:\n                            mainUi = window.document.querySelector('ui-view');\n\n                            mainUi.style.display = 'none';\n                            message = gettextCatalog.getString('You are not logged in or your session' + ' has expired, please login again.');\n                            _context.next = 5;\n                            return $mdDialog.show($mdDialog.alert().clickOutsideToClose(false).title(gettextCatalog.getString('Authentication problem')).textContent(message).theme('alert').ariaLabel('Auth problem dialog').ok(gettextCatalog.getString('Understand')));\n\n                        case 5:\n                            mainUi.style.display = '';\n                            $ngRedux.dispatch(UserModule.doLogout());\n                            $state.go('login', { location: window.location.pathname });\n\n                        case 8:\n                        case 'end':\n                            return _context.stop();\n                    }\n                }\n            }, _callee, undefined);\n        }));\n\n        return function showCredentialsPopUp() {\n            return _ref.apply(this, arguments);\n        };\n    }();\n\n    var handleAuthProblem = function handleAuthProblem() {\n        if (!authPopup) {\n            authPopup = showCredentialsPopUp();\n        }\n    };\n\n    _axios2.default.setShowPopUp(showPopUp.bind(undefined));\n    _axios2.default.setHandleAuthProblem(handleAuthProblem.bind(undefined));\n\n    $ngRedux.subscribe(function () {\n        $timeout(function () {\n            $rootScope.$apply(function () {});\n        }, 100);\n    });\n\n    var storeReadyEvent = new CustomEvent('storeSetupReady', { detail: $ngRedux });\n\n    window.dispatchEvent(storeReadyEvent);\n};\n\nrun.$inject = ['$rootScope', '$state', '$mdToast', '$mdDialog', '$ngRedux', '$timeout', '$transitions', 'gettextCatalog'];\n\nexports.run = run;\nexports.scrollToTopOnSuccess = scrollToTopOnSuccess;\nexports.checkProfile = checkProfile;\nexports.setAxiosBaseTokenIfInStorage = setAxiosBaseTokenIfInStorage;//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvQXBwL2FwcC1ydW4uanMuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vc3JjL0FwcC9hcHAtcnVuLmpzP2JmNWMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgZ2V0TGFuZ3VhZ2UsIHNldENhdGFsb2csIHNldFNjb3BlIH0gZnJvbSAnLi4vcGx1Z2lucy9sYW5ndWFnZSc7XG5pbXBvcnQgKiBhcyBQcm9qZWN0c01vZHVsZSBmcm9tICcuLi9zdG9yZS9tb2R1bGVzL3Byb2plY3RzJztcbmltcG9ydCAqIGFzIFVzZXJNb2R1bGUgZnJvbSAnLi4vc3RvcmUvbW9kdWxlcy91c2VyJztcbmltcG9ydCAqIGFzIENvdW50cnlNb2R1bGUgZnJvbSAnLi4vc3RvcmUvbW9kdWxlcy9jb3VudHJpZXMnO1xuaW1wb3J0IGF4aW9zIGZyb20gJy4uL3BsdWdpbnMvYXhpb3MnO1xuaW1wb3J0IFN0b3JhZ2UgZnJvbSAnLi4vU3RvcmFnZSc7XG5cbmNvbnN0IHN0b3JhZ2UgPSBuZXcgU3RvcmFnZSgpO1xuXG5mdW5jdGlvbiBzY3JvbGxUb1RvcE9uU3VjY2Vzcyh0eXBlLCBmcm9tLCB0bykge1xuICAgIGlmICh0eXBlID09PSAnc3VjY2VzcycgJiYgKGZyb20ubmFtZSAhPT0gdG8ubmFtZSB8fCB0by5uYW1lID09PSAnZWRpdFByb2plY3QnKSkge1xuICAgICAgICBjb25zdCBtYWluQ29udGVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoJ21haW4tY29udGVudCcpWzBdO1xuICAgICAgICBpZiAobWFpbkNvbnRlbnQpIHtcbiAgICAgICAgICAgIG1haW5Db250ZW50LnNjcm9sbFRvcCA9IDA7XG4gICAgICAgIH1cbiAgICB9XG59XG5cbmZ1bmN0aW9uIGNoZWNrUHJvZmlsZShwcm9maWxlLCB0KSB7XG4gICAgaWYgKCFwcm9maWxlIHx8ICFwcm9maWxlLm5hbWUgfHwgIXByb2ZpbGUuY291bnRyeSB8fCAhcHJvZmlsZS5vcmdhbmlzYXRpb25faWQpIHtcbiAgICAgICAgY29uc29sZS5sb2coJ1lvdSBjYW4gbm90IG5hdmlnYXRlIHRvIHRoYXQgYXJlYSB3aXRob3V0IGEgdXNlciBwcm9maWxlJyk7XG4gICAgICAgIHJldHVybiB0LnJvdXRlci5zdGF0ZVNlcnZpY2UudGFyZ2V0KCdlZGl0UHJvZmlsZScpO1xuICAgIH1cbiAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKCk7XG59XG5cbmZ1bmN0aW9uIHNldENvdW50cnlJZkVtcHR5KHRvLCAkbmdSZWR1eCkge1xuICAgIGNvbnN0IHN0YXRlID0gJG5nUmVkdXguZ2V0U3RhdGUoKTtcbiAgICBpZiAodG8ubmFtZSA9PT0gJ2Rhc2hib2FyZCcgJiYgc3RhdGUuY291bnRyaWVzLmN1cnJlbnRDb3VudHJ5ID09PSBudWxsKSB7XG4gICAgICAgICRuZ1JlZHV4LmRpc3BhdGNoKENvdW50cnlNb2R1bGUuc2V0Q3VycmVudENvdW50cnkoc3RhdGUudXNlci5wcm9maWxlLmNvdW50cnkpKTtcbiAgICB9XG59XG5cbmZ1bmN0aW9uIHNldEF4aW9zQmFzZVRva2VuSWZJblN0b3JhZ2UoKSB7XG4gICAgY29uc3QgdGtuID0gc3RvcmFnZS5nZXQoJ3Rva2VuJyk7XG4gICAgaWYgKHRrbikge1xuICAgICAgICBheGlvcy5zZXRBdXRoVG9rZW4odGtuKTtcbiAgICB9XG59XG5cbmNvbnN0IHJ1biA9ICgkcm9vdFNjb3BlLCAkc3RhdGUsICRtZFRvYXN0LCAkbWREaWFsb2csICRuZ1JlZHV4LCAkdGltZW91dCwgJHRyYW5zaXRpb25zLCBnZXR0ZXh0Q2F0YWxvZykgPT4ge1xuICAgIHNldENhdGFsb2coZ2V0dGV4dENhdGFsb2cpO1xuICAgIHNldFNjb3BlKCRyb290U2NvcGUpO1xuICAgIGdldExhbmd1YWdlKCk7XG4gICAgY29uc3QgdHJhbnNpdGlvblN0YXJ0ID0gbmV3IEV2ZW50KCdSb3V0ZXJUcmFuc2l0aW9uU3RhcnQnKTtcbiAgICBjb25zdCB0cmFuc2l0aW9uRG9uZSA9IG5ldyBFdmVudCgnUm91dGVyVHJhbnNpdGlvbkRvbmUnKTtcbiAgICBzZXRBeGlvc0Jhc2VUb2tlbklmSW5TdG9yYWdlKCk7XG5cbiAgICAkdHJhbnNpdGlvbnMub25TdGFydCh7fSwgKCkgPT4ge1xuICAgICAgICB3aW5kb3cuZGlzcGF0Y2hFdmVudCh0cmFuc2l0aW9uU3RhcnQpO1xuICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKCk7XG4gICAgfSk7XG5cbiAgICAkdHJhbnNpdGlvbnMub25TdWNjZXNzKHt9LCAodCkgPT4ge1xuICAgICAgICBzY3JvbGxUb1RvcE9uU3VjY2Vzcyh0LmZyb20oKSwgdC50bygpKTtcbiAgICAgICAgc2V0Q291bnRyeUlmRW1wdHkodC50bygpLCAkbmdSZWR1eCk7XG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoKTtcbiAgICB9KTtcblxuICAgICR0cmFuc2l0aW9ucy5vbkVycm9yKHt9LCAoKSA9PiB7XG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoKTtcbiAgICB9KTtcblxuICAgICR0cmFuc2l0aW9ucy5vbkZpbmlzaCh7fSwgKHQpID0+IHtcbiAgICAgICAgY29uc3QgdG8gPSB0LnRvKCk7XG4gICAgICAgIHdpbmRvdy5kaXNwYXRjaEV2ZW50KHRyYW5zaXRpb25Eb25lKTtcbiAgICAgICAgJG5nUmVkdXguZGlzcGF0Y2goUHJvamVjdHNNb2R1bGUuc2V0Q3VycmVudFByb2plY3QodC5wYXJhbXMoKS5hcHBOYW1lKSk7XG4gICAgICAgIGNvbnN0IHN0YXRlID0gJG5nUmVkdXguZ2V0U3RhdGUoKTtcbiAgICAgICAgaWYgKHRvICYmIHRvLnByb2ZpbGVSZXF1aXJlZCkge1xuICAgICAgICAgICAgcmV0dXJuIGNoZWNrUHJvZmlsZShzdGF0ZS51c2VyLnByb2ZpbGUsIHQpO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0byAmJiB0by5mb3JiaWRBdXRoZW50aWNhdGVkICYmIHN0YXRlLnVzZXIudG9rZW4pIHtcbiAgICAgICAgICAgIHJldHVybiB0LnJvdXRlci5zdGF0ZVNlcnZpY2UudGFyZ2V0KCdteS1wcm9qZWN0cycpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoKTtcbiAgICB9KTtcblxuICAgIGNvbnN0IHNob3dQb3BVcCA9ICgpID0+IHtcbiAgICAgICAgJG1kVG9hc3Quc2hvdyhcbiAgICAgICAgICAkbWRUb2FzdC5zaW1wbGUoKVxuICAgICAgICAgICAgLnRleHRDb250ZW50KGdldHRleHRDYXRhbG9nLmdldFN0cmluZygnT3BzISBzb21ldGhpbmcgd2VudCB3cm9uZywgdHJ5IGFnYWluIGxhdGVyLicpKVxuICAgICAgICAgICAgLnBvc2l0aW9uKCdib3R0b20gcmlnaHQnKVxuICAgICAgICAgICAgLmhpZGVEZWxheSgzMDAwKVxuICAgICAgICApO1xuXG4gICAgfTtcblxuICAgIGxldCBhdXRoUG9wdXAgPSB1bmRlZmluZWQ7XG4gICAgY29uc3Qgc2hvd0NyZWRlbnRpYWxzUG9wVXAgPSBhc3luYyAoKSA9PiB7XG4gICAgICAgIGNvbnN0IG1haW5VaSA9IHdpbmRvdy5kb2N1bWVudC5xdWVyeVNlbGVjdG9yKCd1aS12aWV3Jyk7XG4gICAgICAgIG1haW5VaS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnO1xuICAgICAgICBjb25zdCBtZXNzYWdlID0gZ2V0dGV4dENhdGFsb2cuZ2V0U3RyaW5nKCdZb3UgYXJlIG5vdCBsb2dnZWQgaW4gb3IgeW91ciBzZXNzaW9uJyArXG4gICAgICAgICcgaGFzIGV4cGlyZWQsIHBsZWFzZSBsb2dpbiBhZ2Fpbi4nKTtcbiAgICAgICAgYXdhaXQgJG1kRGlhbG9nLnNob3coXG4gICAgICAgICAgJG1kRGlhbG9nLmFsZXJ0KClcbiAgICAgICAgICAgIC5jbGlja091dHNpZGVUb0Nsb3NlKGZhbHNlKVxuICAgICAgICAgICAgLnRpdGxlKGdldHRleHRDYXRhbG9nLmdldFN0cmluZygnQXV0aGVudGljYXRpb24gcHJvYmxlbScpKVxuICAgICAgICAgICAgLnRleHRDb250ZW50KG1lc3NhZ2UpXG4gICAgICAgICAgICAudGhlbWUoJ2FsZXJ0JylcbiAgICAgICAgICAgIC5hcmlhTGFiZWwoJ0F1dGggcHJvYmxlbSBkaWFsb2cnKVxuICAgICAgICAgICAgLm9rKGdldHRleHRDYXRhbG9nLmdldFN0cmluZygnVW5kZXJzdGFuZCcpKVxuICAgICAgICApO1xuICAgICAgICBtYWluVWkuc3R5bGUuZGlzcGxheSA9ICcnO1xuICAgICAgICAkbmdSZWR1eC5kaXNwYXRjaChVc2VyTW9kdWxlLmRvTG9nb3V0KCkpO1xuICAgICAgICAkc3RhdGUuZ28oJ2xvZ2luJywgeyBsb2NhdGlvbjogd2luZG93LmxvY2F0aW9uLnBhdGhuYW1lIH0pO1xuICAgIH07XG5cbiAgICBjb25zdCBoYW5kbGVBdXRoUHJvYmxlbSA9ICgpID0+IHtcbiAgICAgICAgaWYgKCFhdXRoUG9wdXApIHtcbiAgICAgICAgICAgIGF1dGhQb3B1cCA9IHNob3dDcmVkZW50aWFsc1BvcFVwKCk7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgYXhpb3Muc2V0U2hvd1BvcFVwKHNob3dQb3BVcC5iaW5kKHRoaXMpKTtcbiAgICBheGlvcy5zZXRIYW5kbGVBdXRoUHJvYmxlbShoYW5kbGVBdXRoUHJvYmxlbS5iaW5kKHRoaXMpKTtcblxuICAgICRuZ1JlZHV4LnN1YnNjcmliZSgoKSA9PiB7XG4gICAgICAgICR0aW1lb3V0KCgpID0+IHsgJHJvb3RTY29wZS4kYXBwbHkoKCkgPT4geyB9KTsgfSwgMTAwKTtcbiAgICB9KTtcblxuICAgIGNvbnN0IHN0b3JlUmVhZHlFdmVudCA9IG5ldyBDdXN0b21FdmVudCgnc3RvcmVTZXR1cFJlYWR5JywgeyBkZXRhaWw6ICRuZ1JlZHV4IH0pO1xuXG4gICAgd2luZG93LmRpc3BhdGNoRXZlbnQoc3RvcmVSZWFkeUV2ZW50KTtcblxufTtcblxucnVuLiRpbmplY3QgPSBbXG4gICAgJyRyb290U2NvcGUnLFxuICAgICckc3RhdGUnLFxuICAgICckbWRUb2FzdCcsXG4gICAgJyRtZERpYWxvZycsXG4gICAgJyRuZ1JlZHV4JyxcbiAgICAnJHRpbWVvdXQnLFxuICAgICckdHJhbnNpdGlvbnMnLFxuICAgICdnZXR0ZXh0Q2F0YWxvZydcbl07XG5cbmV4cG9ydCB7IHJ1biwgc2Nyb2xsVG9Ub3BPblN1Y2Nlc3MsIGNoZWNrUHJvZmlsZSwgc2V0QXhpb3NCYXNlVG9rZW5JZkluU3RvcmFnZSB9O1xuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQUE7QUFDQTtBQUFBO0FBQ0E7QUFEQTtBQUNBO0FBQUE7QUFDQTtBQURBO0FBQ0E7QUFBQTtBQUNBO0FBREE7QUFDQTtBQUFBO0FBQ0E7OztBQUFBO0FBQ0E7Ozs7Ozs7OztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQU9BO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFIQTtBQUFBO0FBQ0E7QUFEQTtBQWNBO0FBQ0E7QUFDQTtBQUNBO0FBakJBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFEQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBa0JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBVUE7QUFBQTtBQUFBO0FBQUEiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./src/App/app-run.js\n");

/***/ })

}]);